main_data$uid <- 1:nrow(main_data)
data_short <- main_data %>% filter(uid %in% data$uid)
# check
nrow(data_short) == length(unique(data$uid))
## Remove double entries (recommits) ?
sum(duplicated(data_short)) #no duplicates, but there may be recommits
sum(duplicated(data_short$Full.Name))
#pick up duplicate names and booking dates
data_dups <- data_short[c("Full.Name", "Last.Booking.Date")]
data_dups <- data_dups[duplicated(data_dups),]
data_dups <- filter(data_short, Full.Name %in% data_dups$Full.Name & Last.Booking.Date %in% data_dups$Last.Booking.Date)
data_dups
#we can see that the duplicates arise from recommits so we should remove them from both datasets
data_short <- data_short %>% filter(Booking.Type != "RECOMMIT")
data <- data %>% filter(Booking.Type != "RECOMMIT")
#final check
data_dups <- data_short[c("Full.Name", "Last.Booking.Date")]
data_dups <- data_dups[duplicated(data_dups),]
nrow(data_dups) #equal to 0 so no longer duplicates...
names(data_short)
data %>%
group_by(uid) %>%
count(uid)
length(unique(data_short$uid))
length(unique(data$uid))
OneCharge <- data %>%
group_by(uid) %>%
count(uid) %>%
filter(n==1 | n == 2)
View(OneCharge)
OneCharge <- data %>%
group_by(uid) %>%
count(uid) %>%
filter(n==1 | n == 2) %>%
select(uid)
View(OneCharge)
SimCharges <- data %>%
filter(!uid %in% OneCharge$uid)
View(SimCharges)
getwd()
library(plyr)
library(tidyverse)
data <- read_csv("bookings_clean.csv")
# create ID variable
data$uid <- 1:nrow(data)
# string split columns by comma into new rows
data_analysis <- data %>%
select(Full.Name, Last.Booking.Date, Last.Release.Date, Booking.Type, In.Jail, counts,
agency, Charges, uid, charges_clean) %>%
mutate(all_charges = strsplit(as.character(charges_clean), ",")) %>%
unnest(all_charges)
# Regex for License Suspensions - from patterns we noticed that ALMOST ALL of the charges
# have "LIC" in their charge description
## Obtain IDs where grepl("LIC", data_analysis$charges_clean) == TRUE
# LIC_ids <- data_analysis %>%
#   filter(grepl("LIC", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# LIC_Data <- data_analysis %>%
#   filter(uid %in% LIC_ids$uid)
## obtains IDs where (grepl "DWLS", data_analysis$charges_clean) == TRUE
# DWLS_ids <- data_analysis %>%
#   filter(grepl("DWLS", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# DWLS_Data <- data_analysis %>%
#   filter(uid %in% DWLS_ids$uid)
# Go through LIC_Data and weed out not really driving with license suspended people
# LIC_Data_Clean <- LIC_Data %>%
#   filter(!uid %in% c(23,51,55,90,168,214,262,284,304,355,377,405,
#                      475,512,513,526,545,555,559,573,592,597,602,
#                      699, 763, 777, 783, 819, 863, 935, 984, 1023,
#                      1025, 1111, 1124, 1140, 1141, 1143, 1178, 1205,
#                      1281,1298, 1301, 1324, 1361, 1367, 1377, 1386,
#                      1418, 1457, 1461, 1476, 1513, 1526, 1533, 1546, 1559,
#                      1567, 1572, 1575, 1599, 1633, 1645, 1660, 1692, 1693,
#                      1698, 1728, 1730, 1766, 1788, 1822, 1845, 1851, 1869,
#                      1870, 1886, 1923, 1956, 1957, 1961, 1969, 1970, 1984,
#                      1999, 2061, 2076, 2108, 2151, 2180, 2225, 2274, 2327,
#                      2331, 2332, 2380, 2392, 2442, 2448, 2455, 2460, 2470,
#                      2495, 2507, 2513, 2578, 2586, 2629, 2776, 2800, 2809,
#                      2851, 2886, 2900, 2909, 2928, 2937, 2941, 3004, 3029,
#                      3041, 3043, 3071, 9870, 9832, 9776, 9733, 9720, 9712,
#                      9652, 9614, 9588, 9578, 9559, 9554, 9530, 9527, 9507,
#                      9492, 9466, 9454, 9436, 9430, 9420, 9379, 9353, 9345,
#                      9338, 9326, 9310, 9281, 9267, 9243, 9146, 9141, 9138,
#                      9131, 9130, 9125, 9111, 9105, 9085, 9075, 9062, 9000,
#                      8997, 8991, 8930, 8905, 8900, 8796, 8760, 8749, 8731,
#                      8711, 8645, 8586, 8568, 8549, 8556, 8509, 8472, 8470,
#                      8425, 8402, 8391, 8382))
# Or alternative way
## Obtain IDs where grepl("(?=.*LIC)(?=.*DRIV)", data_analysis$charges_clean) == TRUE
# (?=.*match this expression)(?=.*match this too) - non consuming regular expression
LIC_ids_2 <- data_analysis %>%
filter(grepl("(?=.*LIC)(?=.*DRIV)", charges_clean, perl = T)) %>%
select(uid) %>%
distinct()
LIC_Data_2 <- data_analysis %>%
filter(uid %in% LIC_ids_2$uid)
#DRIVE WITH EXPIRED LICENSE, COUNTERFEITED DRIVERS LICENSE, POSSESS FORGED DRIVERS LICENSE OR ID, POSSESS STOLEN PROP DRIVERS LICENSE
# FTA/DRIVING WHILE LICENSE SUSPENDED OR REVOKED CAUSING DEATH,
# 555, 592, 783, 1124,1140, 1178, 1281,1361, 1386, 1476, 1575, 1583, 1645, 1698, 1845, 1869, 1870, 1961, 1969,
# 2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529, 5640, 5731, 5885, 6066, 6225,
# 6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190, 8391, 8509, 8645, 9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870,
#Remove these IDS - they are associated with FRAUD, and underage drinking
LIC_Data_Clean <- LIC_Data_2 %>%
filter(!uid %in% c(555,592,783,1124,1140,1178,1281,1361,1386,1476,1575,1583,1645, 1698, 1845, 1869, 1870, 1961, 1969,
2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529,
5640, 5731, 5885, 6066, 6225,6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190, 8391, 8509, 8645,
9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870))
#Find those with MOVING TRAFFIC VIOL OPERATE MOTOR VEHICLE WO VALID LICENSE charge, it might have not been picked up in the last
#regex
Other1 <- data_analysis %>%
filter(grepl(pattern = "MOVING TRAFFIC VIOL OPERATE MOTOR", charges_clean)) %>%
select(uid) %>%
distinct()
Other1data <- data_analysis %>%
filter(uid %in% Other1$uid)
#Find those with DWLS(R) charge, it was not picked up in the last regex
Other2 <- data_analysis %>%
filter(grepl(pattern = "DWLS", charges_clean)) %>%
select(uid) %>%
distinct()
Other2data <- data_analysis %>%
filter(uid %in% Other2$uid)
# Compare IDs of all three and only keep unique values.
ids1 <- unique(LIC_Data_Clean$uid)
ids2 <- unique(Other1data$uid)
ids3 <- unique(Other2data$uid)
ids2 <- ids2[!ids2 %in% ids1]
ids3 <- ids3[!ids3 %in% ids1]
FinalIDS <- c(ids1, ids2, ids3)
# Final data set
FinalData <- data_analysis %>%
filter(uid %in% FinalIDS)
# Write csv of dataset
write_csv(FinalData, "RelevantBookings.csv")
rm(list=ls())
#### Analysis ####
library(plyr)
library(tidyverse)
library(lubridate)
data <- read_csv("RelevantBookings.csv")
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
## Convert to Date
data$Last.Booking.Date <- mdy(data$Last.Booking.Date)
data$Last.Release.Date <- mdy(data$Last.Release.Date)
main_data$Last.Booking.Date <- mdy(main_data$Last.Booking.Date)
main_data$Last.Release.Date <- mdy(main_data$Last.Release.Date)
range(data$Last.Booking.Date) # one year of data: 2017-12-31, 2019-01-01
range(main_data$Last.Booking.Date) # one year of data: 2017-12-31, 2019-01-01
## Create a short form of relevant data i.e: (warrants not unlisted)
main_data$uid <- 1:nrow(main_data)
data_short <- main_data %>% filter(uid %in% data$uid)
# check
nrow(data_short) == length(unique(data$uid))
sum(duplicated(data_short)) #no duplicates, but there may be recommits
sum(duplicated(data_short$Full.Name))
#pick up duplicate names and booking dates
data_dups <- data_short[c("Full.Name", "Last.Booking.Date")]
data_dups <- data_dups[duplicated(data_dups),]
data_dups <- filter(data_short, Full.Name %in% data_dups$Full.Name & Last.Booking.Date %in% data_dups$Last.Booking.Date)
data_dups
#we can see that the duplicates arise from recommits so we should remove them from both datasets
data_short <- data_short %>% filter(Booking.Type != "RECOMMIT")
data <- data %>% filter(Booking.Type != "RECOMMIT")
#final check
data_dups <- data_short[c("Full.Name", "Last.Booking.Date")]
data_dups <- data_dups[duplicated(data_dups),]
nrow(data_dups) #equal to 0 so no longer duplicates...
rm(data_dups)
OneCharge <- data %>%
group_by(uid) %>%
count(uid) %>%
filter(n==1 | n == 2) %>%
select(uid)
SimCharges <- data %>%
filter(!uid %in% OneCharge$uid)
View(SimCharges)
SimCharges <- data %>%
filter(!uid %in% OneCharge$uid) %>%
filter(uid %in% c(395, 548, 601, 916, 925, 1041, 1051,1148, 1233,1336, 1468, 1542, 1716, 1797, 1818,
1917,2110,2121,2286,2381,2865,3424,3441,3448,3730,3773,4034,4069,4150,4174,4450, 4633,
4656,4773,4817,4849,4920,5036,5407, 5654, 5715, 5890, 6010, 6040, 6140, 6187, 6223, 6307,
6405, 6458, 6619, 6783, 6848, 7186, 7225, 7507, 7583, 7653, 7677, 7967,8189, 8374, 8392,
8634, 9010, 9034, 9056, 9185, 9240, 9607, 9622, 9774)) %>%
select(uid)
dwls_high <- data %>%
filter(uid %in% OneCharge$uid | uid %in% SimCharges$uid)
411 + 285
length(unique(dwls_high$uid))
length(unique(OneCharge$uid))
length(unique(SimCharges$uid))
View(SimCharges)
SimCharges <- data %>%
filter(!uid %in% OneCharge$uid) %>%
filter(uid %in% c(395, 548, 601, 916, 925, 1041, 1051,1148, 1233,1336, 1468, 1542, 1716, 1797, 1818,
1917,2110,2121,2286,2381,2865,3424,3441,3448,3730,3773,4034,4069,4150,4174,4450, 4633,
4656,4773,4817,4849,4920,5036,5407, 5654, 5715, 5890, 6010, 6040, 6140, 6187, 6223, 6307,
6405, 6458, 6619, 6783, 6848, 7186, 7225, 7507, 7583, 7653, 7677, 7967,8189, 8374, 8392,
8634, 9010, 9034, 9056, 9185, 9240, 9607, 9622, 9774)) %>%
select(uid) %>%
distinct()
411+70
length(unique(dwls_high$uid))
length(unique(data$uid))
length(unique(data_short$uid))
View(dwls_high)
filter(data_short, uid %in% OneCharge$uid)
OneChargeData<-filter(data_short, uid %in% OneCharge$uid)
View(OneChargeData)
OneChargeData[! is.na(OneChargeData$In.Jail),]
nrow(OneChargeData[! is.na(OneChargeData$In.Jail),])
View(OneChargeData)
nrow(OneChargeData[OneChargeData$Last.Booking.Date == OneChargeData$Last.Release.Date,])
nrow(data_short[! is.na(data_short$In.Jail),])
length(unique(OneCharge$uid))
length(unique(data$uid)) #around 1091
OneChargeData<-filter(data_short, uid %in% OneCharge$uid)
nrow(OneChargeData[! is.na(OneChargeData$In.Jail),])
nrow(OneChargeData[OneChargeData$Last.Booking.Date == OneChargeData$Last.Release.Date,])
nrow(data_short[! is.na(data_short$In.Jail),])
nrow(OneChargeData[OneChargeData$Last.Booking.Date == OneChargeData$Last.Release.Date,])
View(OneChargeData)
View(data_short)
OneChargeDataL <- filter(data, uid %in% OneCharge$uid)
View(OneChargeDataL)
RM(OneChargeDataL)
RM(OneChargeDataL)
rm(OneChargeDataL)
View(OneChargeData)
grepl("3RD | 2ND | HABITUAL", charges_clean[2])
grepl("3RD | 2ND | HABITUAL", OneChargeData$charges_clean[2])
grepl("3RD | 2ND | HABITUAL", OneChargeData$charges_clean[6])
grepl("3RD | 2ND | HABITUAL", OneChargeData$charges_clean[13])
grepl("3RD | 2ND | HABIT", OneChargeData$charges_clean[13])
OneChargeData <- OneChargeData %>% mutate(Subsequent = ifelse(grepl("3RD | 2ND | HABIT", charges_clean),1,0))
nrow(OneChargeData[!is.na(OneChargeData$In.Jail) & OneChargeData$Subsequent==1 ,]) #116
OneChargeData <- OneChargeData %>% mutate(FTA = ifelse(grepl("FTA", charges_clean),1,0))
nrow(OneChargeData[!is.na(OneChargeData$In.Jail) & OneChargeData$FTA==1 ,]) #29
50+29
79/116
nrow(data_short[data_short$Last.Booking.Date == data_short$Last.Release.Date,]) #364
dwls_high
View(data_short)
nrow(data_short[data_short$Last.Booking.Date == data_short$Last.Release.Date,]) #1005
data_short$Last.Booking.Date == data_short$Last.Release.Date
nrow(data_short[!is.na(data_short$Last.Booking.Date == data_short$Last.Release.Date),]) #1005
data_short <- data_short %>% mutate(Subsequent = ifelse(grepl("3RD | 2ND | HABIT", charges_clean),1,0))
nrow(data_short[!is.na(data_short$In.Jail) & data_short$Subsequent==1 ,]) #29
data_short <- data_short %>% mutate(FTA = ifelse(grepl("FTA", charges_clean),1,0))
nrow(data_short[!is.na(data_short$In.Jail) & data_short$FTA==1 ,]) #50
190+179
369/614
rm(list=ls())
library(plyr)
library(tidyverse)
data <- read_csv("bookings_clean.csv")
# create ID variable
data$uid <- 1:nrow(data)
# string split columns by comma into new rows
data_analysis <- data %>%
select(Full.Name, Last.Booking.Date, Last.Release.Date, Booking.Type, In.Jail, counts,
agency, Charges, uid, charges_clean) %>%
mutate(all_charges = strsplit(as.character(charges_clean), ",")) %>%
unnest(all_charges)
# Regex for License Suspensions - from patterns we noticed that ALMOST ALL of the charges
# have "LIC" in their charge description
## Obtain IDs where grepl("LIC", data_analysis$charges_clean) == TRUE
# LIC_ids <- data_analysis %>%
#   filter(grepl("LIC", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# LIC_Data <- data_analysis %>%
#   filter(uid %in% LIC_ids$uid)
## obtains IDs where (grepl "DWLS", data_analysis$charges_clean) == TRUE
# DWLS_ids <- data_analysis %>%
#   filter(grepl("DWLS", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# DWLS_Data <- data_analysis %>%
#   filter(uid %in% DWLS_ids$uid)
# Go through LIC_Data and weed out not really driving with license suspended people
# LIC_Data_Clean <- LIC_Data %>%
#   filter(!uid %in% c(23,51,55,90,168,214,262,284,304,355,377,405,
#                      475,512,513,526,545,555,559,573,592,597,602,
#                      699, 763, 777, 783, 819, 863, 935, 984, 1023,
#                      1025, 1111, 1124, 1140, 1141, 1143, 1178, 1205,
#                      1281,1298, 1301, 1324, 1361, 1367, 1377, 1386,
#                      1418, 1457, 1461, 1476, 1513, 1526, 1533, 1546, 1559,
#                      1567, 1572, 1575, 1599, 1633, 1645, 1660, 1692, 1693,
#                      1698, 1728, 1730, 1766, 1788, 1822, 1845, 1851, 1869,
#                      1870, 1886, 1923, 1956, 1957, 1961, 1969, 1970, 1984,
#                      1999, 2061, 2076, 2108, 2151, 2180, 2225, 2274, 2327,
#                      2331, 2332, 2380, 2392, 2442, 2448, 2455, 2460, 2470,
#                      2495, 2507, 2513, 2578, 2586, 2629, 2776, 2800, 2809,
#                      2851, 2886, 2900, 2909, 2928, 2937, 2941, 3004, 3029,
#                      3041, 3043, 3071, 9870, 9832, 9776, 9733, 9720, 9712,
#                      9652, 9614, 9588, 9578, 9559, 9554, 9530, 9527, 9507,
#                      9492, 9466, 9454, 9436, 9430, 9420, 9379, 9353, 9345,
#                      9338, 9326, 9310, 9281, 9267, 9243, 9146, 9141, 9138,
#                      9131, 9130, 9125, 9111, 9105, 9085, 9075, 9062, 9000,
#                      8997, 8991, 8930, 8905, 8900, 8796, 8760, 8749, 8731,
#                      8711, 8645, 8586, 8568, 8549, 8556, 8509, 8472, 8470,
#                      8425, 8402, 8391, 8382))
# Or alternative way
## Obtain IDs where grepl("(?=.*LIC)(?=.*DRIV)", data_analysis$charges_clean) == TRUE
# (?=.*match this expression)(?=.*match this too) - non consuming regular expression
LIC_ids_2 <- data_analysis %>%
filter(grepl("(?=.*LIC)(?=.*DRIV)", charges_clean, perl = T)) %>%
select(uid) %>%
distinct()
LIC_Data_2 <- data_analysis %>%
filter(uid %in% LIC_ids_2$uid)
#DRIVE WITH EXPIRED LICENSE, COUNTERFEITED DRIVERS LICENSE, POSSESS FORGED DRIVERS LICENSE OR ID, POSSESS STOLEN PROP DRIVERS LICENSE
# FTA/DRIVING WHILE LICENSE SUSPENDED OR REVOKED CAUSING DEATH,
# 555, 592, 783, 1124,1140, 1178, 1281,1361, 1386, 1476, 1575, 1583, 1645, 1698, 1845, 1869, 1870, 1961, 1969,
# 2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529, 5640, 5731, 5885, 6066, 6225,
# 6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190, 8391, 8509, 8645, 9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870,
#Remove these IDS - they are associated with FRAUD, and underage drinking
LIC_Data_Clean <- LIC_Data_2 %>%
filter(!uid %in% c(555,592,783,1124,1140,1178,1281,1361,1386,1476,1575,1583,1645, 1698, 1845, 1869, 1870, 1961, 1969,
2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529,
5640, 5731, 5885, 6066, 6225,6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190,8228,8391, 8509, 8645,
9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870))
#Find those with MOVING TRAFFIC VIOL OPERATE MOTOR VEHICLE WO VALID LICENSE charge, it might have not been picked up in the last
#regex
Other1 <- data_analysis %>%
filter(grepl(pattern = "MOVING TRAFFIC VIOL OPERATE MOTOR", charges_clean)) %>%
select(uid) %>%
distinct()
Other1data <- data_analysis %>%
filter(uid %in% Other1$uid)
#Find those with DWLS(R) charge, it was not picked up in the last regex
Other2 <- data_analysis %>%
filter(grepl(pattern = "DWLS", charges_clean)) %>%
select(uid) %>%
distinct()
Other2data <- data_analysis %>%
filter(uid %in% Other2$uid)
# Compare IDs of all three and only keep unique values.
ids1 <- unique(LIC_Data_Clean$uid)
ids2 <- unique(Other1data$uid)
ids3 <- unique(Other2data$uid)
ids2 <- ids2[!ids2 %in% ids1]
ids3 <- ids3[!ids3 %in% ids1]
FinalIDS <- c(ids1, ids2, ids3)
# Final data set
FinalData <- data_analysis %>%
filter(uid %in% FinalIDS)
# Write csv of dataset
write_csv(FinalData, "RelevantBookings.csv")
getwd()
rm(list=ls())
#### Analysis ####
library(plyr)
library(tidyverse)
library(lubridate)
data <- read_csv("RelevantBookings.csv")
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
View(data)
## Convert to Date
data$Last.Booking.Date <- mdy(data$Last.Booking.Date)
data$Last.Release.Date <- mdy(data$Last.Release.Date)
main_data$Last.Booking.Date <- mdy(main_data$Last.Booking.Date)
main_data$Last.Release.Date <- mdy(main_data$Last.Release.Date)
range(data$Last.Booking.Date) # one year of data: 2017-12-31, 2019-01-01
range(main_data$Last.Booking.Date) # one year of data: 2017-12-31, 2019-01-01
main_data$uid <- 1:nrow(main_data)
data_short <- main_data %>% filter(uid %in% data$uid)
# check
nrow(data_short) == length(unique(data$uid))
View(data_short)
length(data$uid)
length(unique(data$uid))
View(data)
View(data_short)
View(main_data)
library(plyr)
library(tidyverse)
data <- read_csv("bookings_clean.csv")
# create ID variable
data$uid <- 1:nrow(data)
# string split columns by comma into new rows
data_analysis <- data %>%
select(Full.Name, Last.Booking.Date, Last.Release.Date, Booking.Type, In.Jail, counts,
agency, Charges, uid, charges_clean) %>%
mutate(all_charges = strsplit(as.character(charges_clean), ",")) %>%
unnest(all_charges)
# Regex for License Suspensions - from patterns we noticed that ALMOST ALL of the charges
# have "LIC" in their charge description
## Obtain IDs where grepl("LIC", data_analysis$charges_clean) == TRUE
# LIC_ids <- data_analysis %>%
#   filter(grepl("LIC", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# LIC_Data <- data_analysis %>%
#   filter(uid %in% LIC_ids$uid)
## obtains IDs where (grepl "DWLS", data_analysis$charges_clean) == TRUE
# DWLS_ids <- data_analysis %>%
#   filter(grepl("DWLS", charges_clean)) %>%
#   select(uid) %>%
#   distinct()
#
# DWLS_Data <- data_analysis %>%
#   filter(uid %in% DWLS_ids$uid)
# Go through LIC_Data and weed out not really driving with license suspended people
# LIC_Data_Clean <- LIC_Data %>%
#   filter(!uid %in% c(23,51,55,90,168,214,262,284,304,355,377,405,
#                      475,512,513,526,545,555,559,573,592,597,602,
#                      699, 763, 777, 783, 819, 863, 935, 984, 1023,
#                      1025, 1111, 1124, 1140, 1141, 1143, 1178, 1205,
#                      1281,1298, 1301, 1324, 1361, 1367, 1377, 1386,
#                      1418, 1457, 1461, 1476, 1513, 1526, 1533, 1546, 1559,
#                      1567, 1572, 1575, 1599, 1633, 1645, 1660, 1692, 1693,
#                      1698, 1728, 1730, 1766, 1788, 1822, 1845, 1851, 1869,
#                      1870, 1886, 1923, 1956, 1957, 1961, 1969, 1970, 1984,
#                      1999, 2061, 2076, 2108, 2151, 2180, 2225, 2274, 2327,
#                      2331, 2332, 2380, 2392, 2442, 2448, 2455, 2460, 2470,
#                      2495, 2507, 2513, 2578, 2586, 2629, 2776, 2800, 2809,
#                      2851, 2886, 2900, 2909, 2928, 2937, 2941, 3004, 3029,
#                      3041, 3043, 3071, 9870, 9832, 9776, 9733, 9720, 9712,
#                      9652, 9614, 9588, 9578, 9559, 9554, 9530, 9527, 9507,
#                      9492, 9466, 9454, 9436, 9430, 9420, 9379, 9353, 9345,
#                      9338, 9326, 9310, 9281, 9267, 9243, 9146, 9141, 9138,
#                      9131, 9130, 9125, 9111, 9105, 9085, 9075, 9062, 9000,
#                      8997, 8991, 8930, 8905, 8900, 8796, 8760, 8749, 8731,
#                      8711, 8645, 8586, 8568, 8549, 8556, 8509, 8472, 8470,
#                      8425, 8402, 8391, 8382))
# Or alternative way
## Obtain IDs where grepl("(?=.*LIC)(?=.*DRIV)", data_analysis$charges_clean) == TRUE
# (?=.*match this expression)(?=.*match this too) - non consuming regular expression
LIC_ids_2 <- data_analysis %>%
filter(grepl("(?=.*LIC)(?=.*DRIV)", charges_clean, perl = T)) %>%
select(uid) %>%
distinct()
LIC_Data_2 <- data_analysis %>%
filter(uid %in% LIC_ids_2$uid)
#DRIVE WITH EXPIRED LICENSE, COUNTERFEITED DRIVERS LICENSE, POSSESS FORGED DRIVERS LICENSE OR ID, POSSESS STOLEN PROP DRIVERS LICENSE
# FTA/DRIVING WHILE LICENSE SUSPENDED OR REVOKED CAUSING DEATH,
# 555, 592, 783, 1124,1140, 1178, 1281,1361, 1386, 1476, 1575, 1583, 1645, 1698, 1845, 1869, 1870, 1961, 1969,
# 2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529, 5640, 5731, 5885, 6066, 6225,
# 6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190, 8391, 8509, 8645, 9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870,
#Remove these IDS - they are associated with FRAUD, and underage drinking
LIC_Data_Clean <- LIC_Data_2 %>%
filter(!uid %in% c(555,592,783,1124,1140,1178,1281,1361,1386,1476,1575,1583,1645, 1698, 1845, 1869, 1870, 1961, 1969,
2380, 2392, 2776, 3171, 3402, 3548, 3835, 3899, 3902, 4337, 4338,4398, 4436, 4984, 5352, 5529,
5640, 5731, 5885, 6066, 6225,6310, 6338, 6499, 7319, 8023, 8176, 8186, 8190,8228,8391, 8509, 8645,
9000, 9125, 9243, 9326, 9420, 9466, 9492, 9870))
#Find those with MOVING TRAFFIC VIOL OPERATE MOTOR VEHICLE WO VALID LICENSE charge, it might have not been picked up in the last
#regex
Other1 <- data_analysis %>%
filter(grepl(pattern = "MOVING TRAFFIC VIOL OPERATE MOTOR", charges_clean)) %>%
select(uid) %>%
distinct()
Other1data <- data_analysis %>%
filter(uid %in% Other1$uid)
#Find those with DWLS(R) charge, it was not picked up in the last regex
Other2 <- data_analysis %>%
filter(grepl(pattern = "DWLS", charges_clean)) %>%
select(uid) %>%
distinct()
Other2data <- data_analysis %>%
filter(uid %in% Other2$uid)
# Compare IDs of all three and only keep unique values.
ids1 <- unique(LIC_Data_Clean$uid)
ids2 <- unique(Other1data$uid)
ids3 <- unique(Other2data$uid)
ids2 <- ids2[!ids2 %in% ids1]
ids3 <- ids3[!ids3 %in% ids1]
FinalIDS <- c(ids1, ids2, ids3)
# Final data set
FinalData <- data_analysis %>%
filter(uid %in% FinalIDS)
# Write csv of dataset
write_csv(FinalData, "RelevantBookings.csv")
rm(list=ls())
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
View(main_data)
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
data <- read_csv("bookings_clean.csv")
View(data)
rm(list=ls())
#### Analysis ####
library(plyr)
library(tidyverse)
library(lubridate)
data <- read_csv("RelevantBookings.csv")
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
View(data)
View(main_data)
View(data)
rm(list=ls())
main_data <- read_csv("bookings_clean.csv") #this includes all datapoints
View(main_data)
View(main_data)
# create UID
main_data$uid <- 1:nrow(main_data)
View(main_data)
LIC <- main_data %>%
filter(grepl("(?=.*LIC)(?=.*DRIV)", charges_clean, perl = T)) %>%
select(uid) %>%
distinct()
LIC_Data <- main_data %>%
filter(uid %in% LIC$uid)
View(LIC_Data)
rm(list=ls())
